**网络层**
* **作用范围**：多个网络
* **任务**：异构网络互联，即跨局域网连接和资源共享，属于通信子网
* **如何完成任务**
  * **软件(协议)**：IP协议，ICMP协议，IGMP协议，ARP协议，路由协议（BGP，RIP，OSPF）
  * **硬件**：路由器（结构，功能）
* **层间关系**：提供给上层尽最大可能交付的传输服务，屏蔽下层的差异（不同局域网的协议）

# 提供什么服务

网络层提供的服务可以是”面向连接“的或是”无连接“的服务。

用于打电话的传统电信网使用**面向连接**的通信方式：它先建立连接预留出网络资源（分组交换中式建立一条虚电路），然后再传送信息，提供的是**可靠传输**的虚电路服务。【逻辑连接，而非像电路交换那样的物理连接】

互联网采用的是**无连接**的方式，发送分组时不需要建立连接。
网络层**向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务**。这样使造价降低，运行灵活。

![pic/虚电路服务和数据报服务](https://image.itbaima.net/images/253/image-2023061518160462.png)

# IPV4

## IP地址

实际上，分类IP地址和划分子网的IP地址已经成为历史，现在用的都是无分类的CIDR

![pic/IP地址编址发展历程]()

### 分类的IP地址

32位IP地址分为网络号和主机号，网络号位数是固定的

① A类地址：网络号占1个字节，首位固定0。网络号0~127
② B类地址：网络号占2个字节，前两位固定10。网络号128~191
③ C类地址：网络号固定3个字节，前三位固定110。网络号192~223
④ D类地址：多播地址，前四位固定1110。网络号224~239
⑤ E类地址：保留地址，前四位固定1111。网络号240~255

32位地址空间有2^32^个地址。A类有2^31^个地址，占50%；B类有 2^30^个地址，占25%；C类有2^29^个地址，占12.5%。D和E类各占6.5%。

对于A类地址，网络号全0表示本网络，网络号全1(除首位0)为127，用于回环测试，因此这两个网络号不分配。A类地址最多指派2^8^-2个网络号
![pic/A类网络详解]()

![pic/B类网络详解]()

![pic/C类网络详解]()


### 划分子网的IP地址

32位IP地址分为网络号，子网号，主机号。

### 无分类编制CIDR

32位IP地址分为网络前缀和主机号。网络前缀的**位数不固定**

**网络前缀位数不固定的好处**：按需分配，避免IP地址浪费

用`\`记录网络前缀的位数：如128.14.35.7/20，网络前缀有20位
**具有相同网络前缀的IP地址在同一个网络下**

**地址掩码**：帮助计算机算出IP地址的网络前缀。由一串1或0组成，对应网络前缀的前n位都是1，后面都是0.
>/20 地址掩码：11111111 11111111 11110000 00000000

**查看ip地址是否和网络A在同一个网络**
**人的做法**：知道网络前缀，直接比对，如果网络前缀一样，就是在同一网络里。
**计算机的做法**：IP地址和地址掩码**按位AND**运算，如果结果是网络A的网络前缀，即在同一网络里。

**路由聚合(构造超网)**：对于多个IP地址，找到它们的公共前缀S，将它们合并为一个聚合路由(网络前缀S)。本来路由表要存放多个路由的，现在只用这一个聚合路由代表它们即可。

## ARP协议

## IP数据包格式

# 路由表

# 分组转发

# 路由选择

# ICMP协议

# IPV6

# IP多播

# VPN

# NAT

